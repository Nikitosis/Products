// ---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop
#include <math.h>

#include "Products.h"
#include "Main.h"
#include "Meals.h"
#include "Recommend.h"
#include "RecommendDialog.h"
// ---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm4 *Form4;

// ---------------------------------------------------------------------------
__fastcall TForm4::TForm4(TComponent* Owner) : TForm(Owner) {
}
// ---------------------------------------------------------------------------

void __fastcall TForm4::Button1Click(TObject *Sender) {
	if (Edit1->Text == "" || Edit2->Text == "" || Edit3->Text == "") {
		ShowMessage("Заполните поля роста,веса и возраста");
	}
	else if (ComboBox1->ItemIndex < 0 || ComboBox2->ItemIndex < 0)
		ShowMessage("Выберите ваш пол и уровень активности");
	else {
		double weight = StrToInt(Edit2->Text);
		double height = StrToInt(Edit1->Text);
		double age = StrToInt(Edit3->Text);
		if (ComboBox1->ItemIndex == 0)
			BMR = 88.36 + (13.4 * weight) + (4.8 * height) - (5.7 * age);
		else
			BMR = 447.6 + (9.2 * weight) + (3.1 * height) - (4.3 * age);
		if (ComboBox2->ItemIndex == 1)
			BMR *= 1.2;
		if (ComboBox2->ItemIndex == 2)
			BMR *= 1.375;
		if (ComboBox2->ItemIndex == 3)
			BMR *= 1.55;
		if (ComboBox2->ItemIndex == 4)
			BMR *= 1.725;
		if (ComboBox2->ItemIndex == 5)
			BMR *= 1.9;
		BMR = ceil(BMR);
		Form8->Label1->Caption =
			"Ваше рекомендуемое количество ккал в день: " + FloatToStr(BMR);
		Form8->BMR = BMR;
		Form8->ShowModal();
		Form8->WatchedRecom=false;
	}

}
// ---------------------------------------------------------------------------

void __fastcall TForm4::FormClose(TObject *Sender, TCloseAction &Action) {
	Form1->Show();
}
// ---------------------------------------------------------------------------

void __fastcall TForm4::Button1MouseEnter(TObject *Sender)
{
	AnsiString s=ExtractFilePath(Application->ExeName);
	Button1->Picture->LoadFromFile(s+"/RecomButton/MouseEnter.bmp");
}
//---------------------------------------------------------------------------

void __fastcall TForm4::FormMouseEnter(TObject *Sender)
{
	AnsiString s=ExtractFilePath(Application->ExeName);
	Button1->Picture->LoadFromFile(s+"/RecomButton/Button.bmp");
}
//---------------------------------------------------------------------------

void __fastcall TForm4::Button6Click(TObject *Sender)
{
TButton *button = dynamic_cast<TButton *>(Sender);         //буквы+цифры
AnsiString s=Form6->Components[FocusIndex]->ClassName();
if(Form6->Components[FocusIndex]->ClassName()=="TEdit")
	{
	  TEdit *edit = (TEdit*)Form6->Components[FocusIndex];
	  int start=edit->SelStart;
	  AnsiString s=edit->Text;
	  s.Delete(start+1,edit->SelLength);    //если выделено,то заменяем
	  s.Insert(button->Caption,start+1);    //вставляем букву
	  edit->SetFocus();
	  edit->Text=s;
	  edit->SelStart=start+1;
	  edit->SelLength=0;
	}
}
}
//---------------------------------------------------------------------------


void __fastcall TForm4::FormShow(TObject *Sender)
{
FocusIndex=1;
}
//---------------------------------------------------------------------------

void __fastcall TForm4::Button6MouseEnter(TObject *Sender)
{
for(int i=0;i<Form4->ComponentCount-1;i++)
	{
	   if(Form4->ActiveControl==Form6->Components[i] && Form6->Components[i]->ClassName()=="TEdit")
		FocusIndex=i;
	}

}
//---------------------------------------------------------------------------

